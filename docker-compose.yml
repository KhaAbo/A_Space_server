services:
  gaze-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gaze-estimation-api
    ports:
      - "8000:8000"
    volumes:
      # Persist storage data
      - ./storage:/app/storage
      # Mount model weights (too large to include in image)
      - ./gaze-estimation-testing-main/gaze-estimation/weights:/app/gaze-estimation-testing-main/gaze-estimation/weights:ro
      # Allow hot-reload during development (optional, comment out for production)
      - ./api:/app/api
      - ./mog-eyecontact:/app/mog-eyecontact
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/api/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# Uncomment this section if you want to enable GPU support (requires nvidia-docker)
# services:
#   gaze-api:
#     build:
#       context: .
#       dockerfile: Dockerfile.gpu
#     deploy:
#       resources:
#         reservations:
#           devices:
#             - driver: nvidia
#               count: 1
#               capabilities: [gpu]
